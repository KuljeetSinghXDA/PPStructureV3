# =========================================================================
# PP-StructureV3 Environment Variables
# =========================================================================

# --- Core Configuration ---
# Device to run inference on; use CPU for Ampere A1 (ARM64). 
DEVICE=cpu
# OCR language code; 'latin' covers many Latin-script languages (en/fr/de/es/pt/etc.). 
# Change to a specific code (e.g., en, ch, fr, de, es, pt, el, th, korean, japan) as needed.
OCR_LANG=latin
# Number of CPU threads used by the pipeline; 8 is the documented CPU baseline. 
CPU_THREADS=8

# --- CPU Threading and BLAS Control ---
# OpenMP threads for parallel regions; align with CPU_THREADS.
OMP_NUM_THREADS=8
# OpenBLAS threads; set to 1 to avoid a second thread pool competing with pipeline threading.
OPENBLAS_NUM_THREADS=1

# --- High-Performance Inference & MKL-DNN ---
# High-Performance Inference (HPI); current docs target x86-64, keep disabled on ARM64.
ENABLE_HPI=false
# MKL-DNN enable; ignored on platforms without MKL-DNN, safe to keep true.
ENABLE_MKLDNN=true

# --- Optional Accuracy Boosters ---
# Enable if pages may be rotated (90/180/270°).
USE_DOC_ORIENTATION_CLASSIFY=false
# Enable if camera/warped pages are common; improves geometry but is CPU-heavy.
USE_DOC_UNWARPING=false
# Enable if lines may be 0°/180° flipped or skewed; improves correctness.
USE_TEXTLINE_ORIENTATION=false

# --- Subpipeline Toggles ---
# Keep table recognition enabled for structural extraction.
USE_TABLE_RECOGNITION=true
# Enable for math-heavy documents (LaTeX extraction); heavier.
USE_FORMULA_RECOGNITION=false
# Enable chart parsing to extract tables from charts; heavier.
USE_CHART_RECOGNITION=false

# --- Model Overrides (optional) ---
# Leave empty to use defaults; set to switch to specific models when desired.
LAYOUT_DETECTION_MODEL_NAME=
TEXT_DETECTION_MODEL_NAME=
TEXT_RECOGNITION_MODEL_NAME=
WIRED_TABLE_STRUCTURE_RECOGNITION_MODEL_NAME=
WIRELESS_TABLE_STRUCTURE_RECOGNITION_MODEL_NAME=
TABLE_CLASSIFICATION_MODEL_NAME=
FORMULA_RECOGNITION_MODEL_NAME=
CHART_RECOGNITION_MODEL_NAME=

# --- Detection/Recognition Parameters (accuracy-leaning defaults) ---
# Layout detection confidence threshold.
LAYOUT_THRESHOLD=0.5

# Prefer short-side limiting with a larger value for small/dense text; increases recall.
TEXT_DET_LIMIT_TYPE=min
# Raise to 1536 for very tiny text if latency is acceptable.
TEXT_DET_LIMIT_SIDE_LEN=1280
# Recall-friendly detection thresholds.
TEXT_DET_THRESH=0.30
TEXT_DET_BOX_THRESH=0.60
TEXT_DET_UNCLIP_RATIO=2.0

# Keep permissive to avoid dropping correct reads at low scores.
TEXT_REC_SCORE_THRESH=0.0
# Throughput knob (not accuracy); raise if RAM allows.
TEXT_RECOGNITION_BATCH_SIZE=2

# --- I/O and Service Limits ---
# Allowed upload extensions for validation.
ALLOWED_EXTENSIONS=.pdf,.jpg,.jpeg,.png,.bmp
# Max upload size in MB.
MAX_FILE_SIZE_MB=50

# --- Concurrency (server-side) ---
# Max in-flight predictions; 1 is safest for CPU stability.
MAX_PARALLEL_PREDICT=1
